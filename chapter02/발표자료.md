# [2장] 분해 전략

## 🔹 소프트웨어 아키텍처

- 소프트웨어 **엘리먼트**, 그들이 **관계**의 구조의 집합
- 아키텍처는 소프트웨어 품질 속성을 결정한다.
    - 런타임 품질 : 확장성, 신뢰성
    - 개발 시점의 품질 : 테스트성, 관리성, 배포성

- 4+1 뷰 모델
    - 시나리오 : 특정 뷰 내에서 어떻게 아키텍처 요소가 협동하여 요청을 처리하는지 기술
    ![image](./images/Untitled%201.png)
    - 마이크로서비스 아키텍처의 경우
        - 구현 뷰에 여러 컴포넌트가 있음
        - 컴포넌트 = 서비스 (자체 논리 뷰를 가짐)

- 계층화 아키텍처 : 소프트웨어 엘리먼트를 계층별로 구성
    - 계층
        - 표현 계층 : UI, API
        - 비즈니스 로직 계층
        - 영속화 계층 : DB와 상호 작용
    ex) 3 layer architecture
    ![image](./images/Untitled%202.png)
    - 문제점
        - 표현 계층, 영속화 계층이 한 개뿐이다.
        - 비즈니스 로직 계층이 영속화 계층에 의존한다.

- 육각형 아키텍처 : 논리 뷰를 비즈니스 로직 중심으로 구성하는 계층화 아키텍처
    - API/UI 가 구현된 인바운드 어댑터가 비즈니스 로직을 호출하고, 비즈니스 로직은 아웃바운드 어댑터를 호출하는 구조
    - 비즈니스 로직에 인바운드/아웃바운드 포트가 있어서 어댑터를 호출할 수 있다. (어댑터가 비즈니스 로직에 의존)
    ex) 포트는 JAVA 에서는 interface 로 구현 가능
    ![image](./images/Untitled%203.png)


    ## 🔹 마이크로서비스 아키텍처

    ### 1) 개념
    ![image](./images/Untitled%204.png)

    - 서비스를 느슨하게 결합
        - 서비스 : 단독 배포 가능한 소프트웨어 컴포넌트
            - command (CUD) / query (R)
        - 느슨하게 결합 : 구현 코드를 감싼 API 를 통해서만 상호작용
            - 유지보수성, 테스트성, 런타임 격리

    ### 2) 아키텍처 정의하기
    ### 1단계 : 시스템 작업 식별 → 핵심 요청 추출해서 추상화

    - 고수준 도메인 모델을 생성
        - 사용자 스토리/시나리오에서의 '명사' → 클래스 → 도메인 모델
            ex) 주문 생성: Consumer, Order 등이 필요
    - 시스템 작업 정의
        - 사용자 스토리/시나리오에서의 '동사' → 커맨드(CUD)/쿼리(R)
            ex) 주문 생성: createOrder() / 메뉴보여주기 : findRestaurantMenu(id) 

    ### 2단계 : 서비스 식별

    - 패턴 1 : 비즈니스 능력 패턴별 분해 → 비즈니스 아키텍처 기반
        - 비즈니스 능력은 조직의 목표/구조/ 비즈니스 프로세스를 분석해서 식별
        - 능력에 따라 또는 연관된 능력 그룹에 따라 서비스 정의
    ![image](./images/Untitled%205.png)

    - 패턴 2 : 하위 도메인 패턴별 분해 → DDD 개념 기반
        - DDD : 문제 해결이 가능한 형태로 도메인을 모델링하는 기법
            - 도메인을 구성하는 각 하위 도메인마다 도메인 모델을 따로 정의
            - 경계 컨텍스트 : 도메인 모델의 범위 ⇒ MSA의 서비스 단위
    ![image](./images/Untitled%206.png)

    - 분해의 장애물
        - 네트워크 지연
        - 동기 IPC로 인한 가용성 저하
        - 데이터/데이터 뷰 일관성 유지
        - 만능 클래스

    ### 3단계 : 서비스별로 API 정의

    - 서비스 API 작업
      1) 외부 클라이언트/ 외부 서비스가 호출하는 시스템 작업
      2) 서비스 간 협동을 지원하려고 외부 서비스 호출 전용으로 만든 작업

    - 시스템 작업을 서비스로 배정
        ex) 서비스 : 주문 서비스 / 작업 : `createOrder()`

    - 서비스 간 협동 지원에 필요한 API 확정 (선행/후행 조건)
        ex)  서비스 : 주문 서비스 / 작업 : `createOrder()` / 협동자 : 소비자 서비스 `verifyConsumerDetails()`, 주방 서비스: `createTicket()`
